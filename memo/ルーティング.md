## ルーティング

フロントコントローラを使うことで、処理を簡単に組み込むことができる。
反面、URLと書くコントローラの対応を制御する必要が出てくる。

そのために「URLからPATH_INFOを抜き出す処理をRequestクラスに実装した。

取得したPath_INFOからコントローラとアクションを特定する処理をルーティングという。

```
  https://domain.com/user/edit?page=2
  この場合のPATH_INFOは　「user/edit」

```

例えば、抜き出した/user/editというPATH_INFOをUserコントローラのeditアクションに対応させるなど、ルールを定義する。

##  ルーティング方法

URLとコントローラを対応付ける
これは、アプリケーションごとに定義する必要がある。

シンプルに連想配列でルーティング定義を行えるようにする。

```

array(
  '/'
    =>array('controller' => 'home', 'action' => 'index'),
  '/user/edit'
    =>array('controller' => 'user', 'action' => 'edit'),
);

```

キー部分にPATH_INFO部分を指定し、値にはコントローラとアクションを記述。
こうすることで、キーの値と現在のPATH_INFOを比較してマッチした場合は、値を返してくれる。


> 書くコントローラはクラスとして定義しているが、URLに大文字が入るのは見栄えが良くない。
> ルーティング上では小文字で定義し、実際にコントローラクラスを読み込む際に大文字に変換して扱う



## 動的ルーティング
`/user?id=1`というURLを`user/1`として扱うなど、GETパラメータとして指定していた部分をPATH_INFOに含めたい場合もある。

ルーティングはPHPで制御できるため、そういった仕組みを盛り込むことも可能。

「コロン(:)で始まる文字列を指定すると、動的なパラメータとして扱えるようにする。

```

array(
  '/user/:id'
    =>array('controller' => 'user', 'action' => 'show')
);

```

`:id`の部分が動的なパラメータになる。
これを正規表現で変換してマッチングさせ、コントローラ側でidの値を取得できるようにする。


## 正規表現とキャプチャ

動的ルーティングは正規表現のキャプチャを使う。
正規表現中のカッコで囲まれた部分を内部で保持する機能。

preg_match()関数の第三引数に変数を指定すると、キャプチャした値を取得することが可能。


```

$pattern '/ab(cd)ef/';
$string = 'abcdefghi';
preg_match($pattern, $string,$matches);

var_dump($matches);

/* 結果

array(2) {
  [0] =>
  string(6) "abcdef"
  [1] =>
  string(2)"cd"
}
*/

```

第三引数で指定した$matches変数にキャプチャした値が格納される。
先頭の要素は、正規表現にマッチした文字列全体。


## 名前キャプチャ

キャプチャした値を使用するとき、数字のキーで操作するのは面倒。

```

$pattern '/ab(?P<foo>cd)ef/';
$string = 'abcdefghi';

preg_match($pattern,%string,$matches);

var_dump($matches);
/* 結果
array(3) {
  [0]=> string(6) "abcdef"
  ["foo"]=> string(2) "cd"
  [1]=> string(2) "cd"
}
*/

```

これらの機能を使って動的ルーティングを実装する。

## 動的なコントローラ、アクションの指定

アクション１つ１つにルーティングを定義していくのは手間、
コントローラやアクションを動的ルーティングの仕組みを使って扱えるようにする。

```

array(
  '/:controller'
    => array('action' => 'index'),
  '/item/:action'
    => array('controller' => 'item');
);

```

連想配列の値にコントローラとアクションを連想配列で指定。
そこに動的パラメータの値をマージして、固定で記述した値も動的パラメータの値も一つの連想配列として扱うことで
動的にコントローラやアクションを指定する。

取得した配列を「ルーティングパラメータ」という

これらのルールに基づいてルーティングを行うのが、「Routerクラス」
